<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Tracker</title>
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-ctrtowvfDRevVOoYjHO7798kcChbEY.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-ctrtowvfDRevVOoYjHO7798kcChbEY.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="48x48"
      href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-ctrtowvfDRevVOoYjHO7798kcChbEY.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-ctrtowvfDRevVOoYjHO7798kcChbEY.png"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --background-color: #ecf0f1;
        --text-color: #34495e;
        --card-background: #ffffff;
        --event-color: #e74c3c;
        --salary-color: #f39c12;
        --milk-color: #9b59b6;
        --export-color: #1abc9c;
      }
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: var(--background-color);
        color: var(--text-color);
      }
      body {
        margin: 0;
        padding: 0;
        overflow-x: hidden; /* Prevent horizontal scroll */
      }
      .calendar-container {
        width: 100%;
        max-width: 100%; /* Ensure it doesn't exceed the viewport width */
        margin: 0 auto;
        overflow: hidden; /* This helps in preventing horizontal scroll */
      }

      .calendar {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Center content within the container */
        padding: 10px;
        box-sizing: border-box; /* Include padding in element's total width */
      }
      @media (max-width: 767px) {
        .calendar-day {
          width: 30px; /* Make the boxes smaller */
          height: 30px;
          margin: 4px;
        }

        .calendar-container {
          padding: 0 10px; /* Ensure padding is adjusted for mobile */
        }
      }
      .large-element {
        width: 100%; /* Ensures the element doesn't exceed the viewport width */
        max-width: 100vw; /* Prevents overflow on mobile */
      }
      * {
        box-sizing: border-box;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 20px;
      }
      .card {
        background-color: var(--card-background);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 300px;
      }
      h1,
      h2,
      h3 {
        color: var(--primary-color);
      }
      input,
      select {
        margin-bottom: 10px;
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      button {
        margin-bottom: 10px;
        padding: 8px 12px;
        box-sizing: border-box;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.1s;
        font-weight: bold;
        color: white;
      }
      button:hover {
        transform: translateY(-2px);
      }
      button:active {
        transform: translateY(1px);
      }
      .event-btn {
        background-color: var(--event-color);
      }
      .salary-btn {
        background-color: var(--salary-color);
      }
      .milk-btn {
        background-color: var(--milk-color);
      }
      .export-btn {
        background-color: var(--export-color);
      }
      ul {
        list-style-type: none;
        padding: 0;
      }
      li {
        margin-bottom: 5px;
        padding: 10px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .event-item {
        flex-grow: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 10px;
        border-radius: 5px;
      }
      .event-details {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }
      .event-name {
        font-weight: bold;
      }
      .event-type-date {
        font-size: 0.9em;
        opacity: 0.8;
      }
      .event-checkbox {
        margin-left: 10px;
      }
      .celebrated {
        text-decoration: line-through;
      }
      .event-today {
        animation: blink 1s infinite;
      }
      .event-tomorrow {
        animation: pulse 2s infinite;
      }
      @keyframes blink {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: var(--primary-color);
        color: white;
      }
      .remove-btn {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 0.8em;
      }
      .remove-btn:hover {
        background-color: #c0392b;
      }
      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }
      .calendar-day {
        padding: 10px;
        text-align: center;
        background-color: #f1f1f1;
        cursor: pointer;
        border-radius: 5px;
        transition: all 0.3s ease;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      .calendar-day:hover {
        background-color: #e0e0e0;
        transform: scale(1.05);
      }
      .calendar-day.active {
        background-color: var(--milk-color);
        color: white;
      }
      .calendar-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .calendar-controls button {
        width: auto;
      }
      .current-month-year {
        padding: 5px 10px;
        background-color: var(--milk-color);
        color: white;
        border-radius: 5px;
      }
      .quantity-modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        border-radius: 10px;
        animation: modalAppear 0.3s ease-out;
        position: relative;
      }
      @keyframes modalAppear {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .emoji-animation {
        display: inline-block;
        animation: emojiPop 0.5s ease-out;
      }
      @keyframes emojiPop {
        0% {
          transform: scale(0);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }
      .milk-calendar {
        background-color: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      }
      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-bottom: 10px;
      }
      .calendar-weekday {
        text-align: center;
        font-weight: bold;
        color: var(--primary-color);
      }
      .watermark {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 14px;
        color: rgba(0, 0, 0, 0.3);
        pointer-events: none;
      }
      .event-message {
        background-color: var(--event-color);
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
        animation: colorChange 5s infinite;
      }
      @keyframes colorChange {
        0% {
          background-color: #e74c3c;
          color: white;
        }
        33% {
          background-color: #f39c12;
          color: black;
        }
        66% {
          background-color: #9b59b6;
          color: white;
        }
        100% {
          background-color: #e74c3c;
          color: white;
        }
      }
      .date-range {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        margin-bottom: 10px;
      }
      .date-range label {
        flex: 0 0 60px;
        margin-right: 10px;
      }
      .date-range input {
        flex: 1;
      }
      .salary-month {
        cursor: pointer;
        padding: 10px;
        background-color: var(--salary-color);
        color: white;
        border-radius: 5px;
        margin-bottom: 5px;
      }
      .salary-month-data {
        display: none;
        margin-bottom: 10px;
      }
      .editable-amount {
        background-color: transparent;
        border: none;
        border-bottom: 1px solid #ddd;
        font-size: inherit;
        padding: 2px;
        width: 80px;
      }
      .editable-amount:focus {
        outline: none;
        border-bottom-color: var(--salary-color);
      }
      .milk-quantity-list {
        margin-top: 20px;
      }
      .milk-quantity-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .milk-quantity-item input {
        width: 80px;
        margin-right: 10px;
      }
      .milk-quantity-item button {
        width: auto;
        padding: 5px 10px;
      }
      .collapsible {
        background-color: var(--milk-color);
        color: white;
        cursor: pointer;
        padding: 18px;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
        border-radius: 5px;
        margin-top: 20px;
      }
      .collapsible:after {
        content: "\002B";
        color: white;
        font-weight: bold;
        float: right;
        margin-left: 5px;
      }
      .active:after {
        content: "\2212";
      }
      .collapsible-content {
        padding: 0 18px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out;
        background-color: #f1f1f1;
        border-radius: 0 0 5px 5px;
      }
      .data-buttons {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
      }
      .data-buttons button {
        padding: 8px 12px;
        font-size: 14px;
      }
      .event-reminder {
        position: fixed;
        top: 20px;
        left: 20px;
        background-color: var(--event-color);
        color: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        max-width: 350px;
        display: none;
      }
      .event-reminder-content {
        margin-bottom: 15px;
      }
      .event-reminder-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
      .event-reminder-actions button {
        background-color: white;
        color: black;
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        min-width: 100px;
        transition: background-color 0.3s;
        font-weight: bold;
      }
      .event-reminder-actions button:hover {
        background-color: #f0f0f0;
        color: black;
      }
      .event-reminder h3 {
        color: white;
        margin-bottom: 10px;
        font-size: 16px;
      }
      .event-reminder p {
        margin: 8px 0;
        font-size: 14px;
      }
      .event-reminder strong {
        font-weight: bold;
      }
      .milk-bill-type {
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
      }
      .milk-bill-type label {
        margin: 0 10px;
      }
      .modal-close {
        position: absolute;
        right: 10px;
        top: 10px;
        cursor: pointer;
        font-size: 20px;
      }
      .milk-bill-section {
        margin-top: 20px;
      }
      .milk-bill-section h3 {
        margin-bottom: 10px;
      }
      .hidden {
        display: none;
      }
      .customization-icon {
        position: fixed;
        top: 20px;
        left: 20px;
        font-size: 24px;
        cursor: pointer;
        z-index: 1000;
      }
      .customization-modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }
      .customization-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        border-radius: 10px;
      }
      .customization-content h2 {
        text-align: center;
        color: #3498db;
        margin-bottom: 20px;
      }
      .customization-content div {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 15px;
      }

      .customization-content label {
        display: block;
        text-align: center;
        margin-top: 5px;
      }
      .customization-content input[type="checkbox"] {
        margin: 0;
      }
      .customization-content input[type="text"] {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        box-sizing: border-box;
      }
      .customization-content button {
        width: 100%;
        padding: 10px;
        background-color: #000;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .customization-content button:hover {
        background-color: #333;
      }
      #eventsCheck + label {
        color: var(--event-color);
      }
      #salaryCheck + label {
        color: var(--salary-color);
      }
      #milkCheck + label {
        color: var(--milk-color);
      }
      .user-name {
        font-size: 36px;
        text-align: center;
        margin-bottom: 20px;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientAnimation 5s ease infinite;
      }
      @keyframes gradientAnimation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }
        .container {
          flex-direction: column;
        }
        .card {
          min-width: 100%;
        }
        .calendar-day {
          padding: 5px;
          font-size: 0.9em;
          min-height: 50px;
        }
        .calendar-controls {
          flex-wrap: wrap;
        }
        .current-month-year {
          order: -1;
          width: 100%;
          text-align: center;
          margin-bottom: 10px;
        }
        .data-buttons {
          position: static;
          justify-content: center;
          margin-bottom: 20px;
        }
        .event-reminder {
          left: 10px;
          right: 10px;
          max-width: calc(100% - 20px);
        }
        .event-reminder-actions {
          flex-direction: row;
          justify-content: space-between;
        }
        .event-reminder-actions button {
          min-width: 45%;
        }
      }
      .editable-date {
        border: none;
        border-bottom: 1px solid #ddd;
        padding: 2px;
        font-size: inherit;
        cursor: pointer;
      }
      .editable-date:focus {
        outline: none;
        border-bottom-color: var(--salary-color);
      }
      .total-row {
        background-color: #f8f9fa;
      }
      .total-row td {
        padding: 10px;
        border-top: 2px solid #ddd;
      }
      .amount-container {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .amount-row {
        display: flex;
        align-items: center;
        gap: 2px;
      }
      .editable-amount {
        width: 80px;
        border: none;
        border-bottom: 1px solid #ddd;
        padding: 2px;
        margin-left: 2px;
      }
      .editable-amount:focus {
        outline: none;
        border-bottom-color: var(--salary-color);
      }
      .quick-amounts {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }
      .quick-amount-btn {
        background-color: var(--salary-color);
        color: white;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        font-size: 0.9em;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        margin: 0;
      }
      .quick-amount-btn:hover {
        background-color: #e67e22;
        transform: translateY(-2px);
      }
      .quick-amount-edit {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
      }

      .quick-amount-edit input {
        width: 100px;
        margin-bottom: 10px;
      }

      .quick-amount-edit-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
      }
      .input-group {
        position: relative;
        margin-bottom: 10px;
      }

      .input-group label {
        display: none;
        font-size: 0.9em;
        color: #666;
        margin-bottom: 4px;
      }

      @media (max-width: 768px) {
        .input-group label {
          display: block;
        }
      }
      .milk-dates-summary {
        margin-top: 10px;
        padding: 10px;
        background-color: var(--card-background);
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: none;
      }
      .show-dates-btn {
        background-color: var(--milk-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        font-size: 14px;
      }
      .show-dates-btn:hover {
        opacity: 0.9;
      }
      .marked-date {
        display: inline-block;
        margin: 2px 4px;
        padding: 2px 6px;
        background-color: #f0f0f0;
        border-radius: 3px;
        font-size: 12px;
      }
      .quick-quantities {
        display: flex;
        gap: 8px;
        margin: 10px 0;
        flex-wrap: wrap;
      }

      .quick-quantity-btn {
        background-color: var(--milk-color);
        color: white;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        font-size: 0.9em;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
        margin: 0;
      }

      .quick-quantity-btn:hover {
        background-color: #8e44ad;
        transform: translateY(-2px);
      }

      .quantity-edit-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        display: none;
      }

      .quantity-edit-modal input {
        width: 100px;
        margin-bottom: 10px;
      }

      .quantity-edit-modal .edit-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
      }
      .date-preview {
        position: absolute;
        background-color: var(--milk-color);
        color: white;
        padding: 8px 12px;
        border-radius: 50%;
        font-size: 18px;
        font-weight: bold;
        pointer-events: none;
        animation: fadeIn 0.3s ease-in;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: scale(1);
        }
        to {
          opacity: 0;
          transform: scale(0.8);
        }
      }
    </style>
  </head>
  <body>
    <div class="customization-icon" onclick="showCustomizationModal()">‚öôÔ∏è</div>
    <div id="customizationModal" class="customization-modal">
      <div class="customization-content">
        <h2>Customize Your Tracker</h2>
        <div>
          <input type="checkbox" id="eventsCheck" checked />
          <label for="eventsCheck">Events of the Day</label>
        </div>
        <div>
          <input type="checkbox" id="salaryCheck" checked />
          <label for="salaryCheck">Salary Tracker</label>
        </div>
        <div>
          <input type="checkbox" id="milkCheck" checked />
          <label for="milkCheck">Milk Bill Calendar</label>
        </div>
        <div>
          <input type="text" id="userName" placeholder="Enter your name" />
        </div>
        <button onclick="applyCustomization()">Confirm</button>
      </div>
    </div>

    <div id="userNameDisplay" class="user-name"></div>
    <h1 style="text-align: center">
      <span id="userNameTitle"></span>Personal Tracker
    </h1>

    <div class="data-buttons">
      <button onclick="downloadData()" class="export-btn">Download Data</button>
      <button onclick="uploadData()" class="export-btn">Upload Data</button>
    </div>
    <div id="eventReminder" class="event-reminder">
      <div id="eventReminderContent" class="event-reminder-content"></div>
      <div class="event-reminder-actions">
        <button onclick="dismissReminder()">Dismiss</button>
        <button onclick="snoozeReminder()">Snooze (1 hour)</button>
      </div>
    </div>
    <div class="container">
      <div class="card" id="eventsCard">
        <h2>Events of the Day</h2>
        <div class="input-group">
          <label for="eventName">Name</label>
          <input type="text" id="eventName" placeholder="Name" />
        </div>
        <div class="input-group">
          <label for="eventType">Event Type</label>
          <select id="eventType">
            <option value="">Select Event Type</option>
            <option value="Birthday">Birthday</option>
            <option value="Wedding Anniversary">Wedding Anniversary</option>
          </select>
        </div>
        <div class="input-group">
          <label for="eventDate">Event Date</label>
          <input type="date" id="eventDate" name="eventDate" />
        </div>
        <button class="event-btn" onclick="addEvent()">Add Event</button>
        <ul id="eventList"></ul>
      </div>

      <div class="card" id="salaryCard">
        <h2>Salary Tracker</h2>
        <div class="input-group">
          <label for="studentName">Student Name</label>
          <input type="text" id="studentName" placeholder="Student Name" />
        </div>
        <div class="input-group">
          <label for="salaryAmount">Amount</label>
          <input type="number" id="salaryAmount" placeholder="Amount (‚Çπ)" />
        </div>
        <div class="quick-amounts">
          <button class="quick-amount-btn" onclick="setQuickAmount(500)">‚Çπ500</button>
          <button class="quick-amount-btn" onclick="setQuickAmount(1000)">‚Çπ1000</button>
        </div>
        <div class="input-group">
          <label for="salaryDate">Payment Date</label>
          <input type="date" id="salaryDate" required />
        </div>
        <button class="salary-btn" onclick="addSalary()">Add Salary</button>
        <div id="salaryData"></div>
      </div>

      <div class="card milk-calendar" id="milkCard">
        <h2>Milk Bill Calendar</h2>
        <div class="milk-bill-type">
          <label>
            <input
              type="radio"
              name="milkBillType"
              value="1~MB"
              checked
              onchange="changeMilkBillType()"
            />
            1~MB
          </label>
          <label>
            <input
              type="radio"
              name="milkBillType"
              value="2~MB"
              onchange="changeMilkBillType()"
            />
            2~MB
          </label>
        </div>
        <div class="calendar-controls">
          <button class="milk-btn" onclick="changeMonth(-1)">
            ‚óÄÔ∏è Previous
          </button>
          <div class="current-month-year" id="currentMonth"></div>
          <button class="milk-btn" onclick="changeMonth(1)">Next ‚ñ∂Ô∏è</button>
        </div>
        <div class="calendar-weekdays">
          <div class="calendar-weekday">Sun</div>
          <div class="calendar-weekday">Mon</div>
          <div class="calendar-weekday">Tue</div>
          <div class="calendar-weekday">Wed</div>
          <div class="calendar-weekday">Thu</div>
          <div class="calendar-weekday">Fri</div>
          <div class="calendar-weekday">Sat</div>
        </div>
        <div class="calendar" id="milkCalendar"></div>
        <button class="show-dates-btn" onclick="toggleMarkedDates()">Show Marked Dates</button>
        <div class="milk-dates-summary" id="markedDatesSummary"></div>
        <div class="milk-bill-section" id="milkBill1">
          <h3>1st Milk Bill</h3>
          <div class="input-group">
            <label for="startDate1">From Date</label>
            <input type="date" id="startDate1" />
          </div>
          <div class="input-group">
            <label for="endDate1">To Date</label>
            <input type="date" id="endDate1" />
          </div>
          <button class="milk-btn" onclick="analyzeMilkConsumption(1)">
            Analyze üìä
          </button>
          <p id="analysisResult1"></p>
        </div>
        <div class="milk-bill-section hidden" id="milkBill2">
          <h3>2nd Milk Bill</h3>
          <div class="input-group">
            <label for="startDate2">From Date</label>
            <input type="date" id="startDate2" />
          </div>
          <div class="input-group">
            <label for="endDate2">To Date</label>
            <input type="date" id="endDate2" />
          </div>
          <button class="milk-btn" onclick="analyzeMilkConsumption(2)">
            Analyze üìä
          </button>
          <p id="analysisResult2"></p>
        </div>
        <button class="collapsible">Milk Quantities and Prices</button>
        <div class="collapsible-content">
          <div class="milk-quantity-list">
            <h4>1st Milk Bill</h4>
            <div id="milkQuantityList1"></div>
            <div class="milk-quantity-item">
              <input
                type="number"
                id="newMilkQuantity1"
                placeholder="Quantity (L)"
                step="0.1"
              />
              <input type="number" id="newMilkPrice1" placeholder="Price (‚Çπ)" />
              <button class="milk-btn" onclick="addMilkQuantity(1)">Add</button>
            </div>
          </div>
          <div
            class="milk-quantity-list hidden"
            id="milkQuantityList2Container"
          >
            <h4>2nd Milk Bill</h4>
            <div id="milkQuantityList2"></div>
            <div class="milk-quantity-item">
              <input
                type="number"
                id="newMilkQuantity2"
                placeholder="Quantity (L)"
                step="0.1"
              />
              <input type="number" id="newMilkPrice2" placeholder="Price (‚Çπ)" />
              <button class="milk-btn" onclick="addMilkQuantity(2)">Add</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>Export Data</h2>
        <button class="export-btn" onclick="exportToPDF()">
          Export to PDF üìÑ
        </button>
      </div>
    </div>

    <div id="quantityModal" class="quantity-modal">
      <div class="modal-content">
        <span class="modal-close" onclick="closeQuantityModal()">&times;</span>
        <h3>Select Milk Quantity</h3>
        <div id="milkQuantity1Container">
          <h4>1st Milk Bill</h4>
          <select id="milkQuantity1"></select>
          <div class="quick-quantities" id="quickQuantities1"></div>
        </div>
        <div id="milkQuantity2Container" class="hidden">
          <h4>2nd Milk Bill</h4>
          <select id="milkQuantity2"></select>
          <div class="quick-quantities" id="quickQuantities2"></div>
        </div>
        <button class="milk-btn" onclick="confirmMilkQuantity()">
          Confirm ü•õ
        </button>
      </div>
    </div>

    <div class="watermark">Made by @Rahul üéôÔ∏è</div>

    <div class="quick-amount-edit" id="quickAmountEdit">
      <input type="number" id="newQuickAmount" placeholder="Enter amount">
      <div class="quick-amount-edit-buttons">
        <button class="salary-btn" onclick="saveQuickAmount()">Save</button>
        <button class="remove-btn" onclick="closeQuickAmountEdit()">Cancel</button>
      </div>
    </div>

    <div class="quantity-edit-modal" id="quantityEditModal">
      <input type="number" id="newQuantityValue" step="0.5" placeholder="Enter quantity">
      <div class="edit-buttons">
        <button class="milk-btn" onclick="saveQuickQuantity()">Save</button>
        <button class="remove-btn" onclick="closeQuantityEdit()">Cancel</button>
      </div>
    </div>

    <script>
      let events = JSON.parse(localStorage.getItem("events")) || [];
      let salaryData = JSON.parse(localStorage.getItem("salaryData")) || {};
      let milkData = JSON.parse(localStorage.getItem("milkData")) || {};
      let milkQuantities = JSON.parse(
        localStorage.getItem("milkQuantities")
      ) || [
        { quantity: 0, price: 0 },
        { quantity: 1, price: 55 },
        { quantity: 1.5, price: 83 },
        { quantity: 2, price: 110 },
      ];
      let milkQuantities2 = JSON.parse(
        localStorage.getItem("milkQuantities2")
      ) || [
        { quantity: 0, price: 0 },
        { quantity: 1, price: 60 },
        { quantity: 1.5, price: 90 },
        { quantity: 2, price: 120 },
      ];
      let currentDate = new Date();
      let selectedDate = null;
      let milkBillType = localStorage.getItem("milkBillType") || "1~MB";
      let userName = localStorage.getItem("userName") || "";
      let selectedCategories = JSON.parse(
        localStorage.getItem("selectedCategories")
      ) || ["events", "salary", "milk"];

      let quickAmounts = JSON.parse(localStorage.getItem("quickAmounts")) || [500, 1000];
      let editingButtonIndex = null;
      let longPressTimer;

      let previousQuantity = null;
      let autoToggleTimeout = null;

      let quickQuantities = JSON.parse(localStorage.getItem("quickQuantities")) || [0.5, 1];
      let editingQuantityIndex = null;
      let editingQuantityBillNumber = null;
      let quantityLongPressTimer;

      // Add these variables with other global variables
      let datePreviewTimer = null;
      let datePreviewElement = null;

      function saveEvents() {
        localStorage.setItem("events", JSON.stringify(events));
        displayEvents();
      }

      function saveSalaryData() {
        localStorage.setItem("salaryData", JSON.stringify(salaryData));
        displaySalaryData();
      }

      function saveMilkData() {
        localStorage.setItem("milkData", JSON.stringify(milkData));
      }

      function saveMilkQuantities() {
        localStorage.setItem("milkQuantities", JSON.stringify(milkQuantities));
        localStorage.setItem(
          "milkQuantities2",
          JSON.stringify(milkQuantities2)
        );
        displayMilkQuantities();
        updateMilkQuantitySelect(1);
        if (milkBillType === "2~MB") {
          updateMilkQuantitySelect(2);
        }
      }

      function addEvent() {
        const name = document.getElementById("eventName").value;
        const type = document.getElementById("eventType").value;
        const date = document.getElementById("eventDate").value;
        if (name && type && date) {
          events.push({ name, type, date, celebrated: false });
          saveEvents();
          document.getElementById("eventName").value = "";
          document.getElementById("eventType").value = "";
          document.getElementById("eventDate").value = "";
          showEmojiAnimation("üéâ", document.querySelector(".event-btn"));
        }
      }

      function displayEvents() {
        const list = document.getElementById("eventList");
        list.innerHTML = "";
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const todayEvents = [];
        const tomorrowEvents = [];
        const otherEvents = [];

        events.forEach((event, index) => {
          const eventDate = new Date(event.date);
          const isEventToday = (
            today.getDate() === eventDate.getDate() && 
            today.getMonth() === eventDate.getMonth()
          );
          const isEventTomorrow = (
            tomorrow.getDate() === eventDate.getDate() && 
            tomorrow.getMonth() === eventDate.getMonth()
          );

          const li = document.createElement("li");
          li.innerHTML = `
            <div class="event-item ${isEventToday ? "event-today" : ""} 
                ${isEventTomorrow ? "event-tomorrow" : ""}" 
                style="background-color: ${getEventColor(event.type)}; 
                color: ${getContrastColor(getEventColor(event.type))};">
                <div class="event-details ${event.celebrated ? "celebrated" : ""}">
                    <span class="event-name">${event.name}</span>
                    <span class="event-type-date">${event.type} - ${new Date(event.date).toLocaleDateString()}</span>
                </div>
                <input type="checkbox" class="event-checkbox" 
                    ${event.celebrated ? "checked" : ""} 
                    onchange="toggleCelebrated(${index})">
                <button class="remove-btn" onclick="removeEvent(${index})">X</button>
            </div>
        `;

          if (isEventToday) {
            todayEvents.push(li);
          } else if (isEventTomorrow) {
            tomorrowEvents.push(li);
          } else {
            otherEvents.push(li);
          }
        });

        todayEvents.forEach((li) => list.appendChild(li));
        tomorrowEvents.forEach((li) => list.appendChild(li));
        otherEvents.forEach((li) => list.appendChild(li));

        checkForEvents();
      }

      function getEventColor(eventType) {
        switch (eventType) {
          case "Birthday":
            return "#FF6B6B";
          case "Wedding Anniversary":
            return "#4ECDC4";
          default:
            return "#45B7D1";
        }
      }

      function getContrastColor(hexcolor) {
        hexcolor = hexcolor.replace("#", "");
        var r = parseInt(hexcolor.substr(0, 2), 16);
        var g = parseInt(hexcolor.substr(2, 2), 16);
        var b = parseInt(hexcolor.substr(4, 2), 16);
        var yiq = (r * 299 + g * 587 + b * 114) / 1000;
        return yiq >= 128 ? "black" : "white";
      }

      function checkForEvents() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        const todayEvents = events.filter(event => {
          const eventDate = new Date(event.date);
          return (
            today.getDate() === eventDate.getDate() &&
            today.getMonth() === eventDate.getMonth() &&
            !event.celebrated
          );
        });

        const tomorrowEvents = events.filter(event => {
          const eventDate = new Date(event.date);
          return (
            tomorrow.getDate() === eventDate.getDate() &&
            tomorrow.getMonth() === eventDate.getMonth()
          );
        });

        if (todayEvents.length > 0 || tomorrowEvents.length > 0) {
          showEventReminder(todayEvents, tomorrowEvents);
        }
      }

      function showEventReminder(todayEvents, tomorrowEvents) {
        const reminderContent = document.getElementById('eventReminderContent');
        let reminderHTML = '';

        if (todayEvents.length > 0) {
          reminderHTML += '<h3>Today\'s Events:</h3>';
          reminderHTML += todayEvents.map(event => `<p>‚Ä¢ <strong>${event.name}'s ${event.type}</p>`).join('');
        }

        if (tomorrowEvents.length > 0) {
          reminderHTML += '<h3>Tomorrow\'s Events:</h3>';
          reminderHTML += tomorrowEvents.map(event => `<p>‚Ä¢ <strong>${event.name}'s ${event.type}</p>`).join('');
        }

        reminderContent.innerHTML = reminderHTML;
        document.getElementById('eventReminder').style.display = 'block';
      }

      function dismissReminder() {
        document.getElementById("eventReminder").style.display = "none";
      }

      function snoozeReminder() {
        dismissReminder();
        setTimeout(() => {
          checkForEvents();
        }, 3600000); // 1 hour
      }

      function toggleCelebrated(index) {
        events[index].celebrated = !events[index].celebrated;
        saveEvents();
        showEmojiAnimation("üéà", document.querySelectorAll("li")[index]);
      }

      function removeEvent(index) {
        events.splice(index, 1);
        saveEvents();
        showEmojiAnimation("üóëÔ∏è", document.querySelectorAll("li")[index]);
      }

      function addSalary() {
        const student = document.getElementById("studentName").value;
        const amount = document.getElementById("salaryAmount").value;
        const date = document.getElementById("salaryDate").value;
        
        if (student && amount && date) {
          const dateObj = new Date(date);
          const month = dateObj.toLocaleString('default', { month: 'long' });
          
          if (!salaryData[month]) {
            salaryData[month] = {};
          }
          salaryData[month][student] = {
            amount: Number(amount),
            date: date
          };
          saveSalaryData();
          document.getElementById("studentName").value = "";
          document.getElementById("salaryAmount").value = "";
          document.getElementById("salaryDate").value = "";
          showEmojiAnimation("", document.querySelector(".salary-btn"));
        }
      }

      function displaySalaryData() {
        const container = document.getElementById("salaryData");
        container.innerHTML = "";
        
        for (const [month, students] of Object.entries(salaryData)) {
          const monthDiv = document.createElement("div");
          let monthTotal = 0;
          
          const studentRows = Object.entries(students).map(([student, data]) => {
            const amount = typeof data === 'object' ? data.amount : data;
            const date = typeof data === 'object' ? data.date : '';
            monthTotal += Number(amount);
            
            return `
              <tr>
                <td>${student}</td>
                <td>
                  <div class="amount-container">
                    <div class="amount-row">
                      ‚Çπ<input type="number" class="editable-amount" value="${amount}" 
                          onchange="updateSalary('${month}', '${student}', this.value)">
                    </div>
                    <input type="date" class="editable-date" value="${date}" 
                      onchange="updateSalaryDate('${month}', '${student}', this.value)">
                  </div>
                </td>
                <td><button class="remove-btn" onclick="removeSalary('${month}', '${student}')">Remove</button></td>
              </tr>
            `;
          }).join("");

          monthDiv.innerHTML = `
            <div class="salary-month" onclick="toggleSalaryMonth('${month}')">
              ${month} <span class="toggle-icon">‚ñº</span>
            </div>
            <div id="salary-${month}" class="salary-month-data">
              <table>
                <tr>
                  <th>Student</th>
                  <th>Amount</th>
                  <th>Action</th>
                </tr>
                ${studentRows}
                <tr class="total-row">
                  <td><strong>Total</strong></td>
                  <td colspan="2"><strong>‚Çπ${monthTotal}</strong></td>
                </tr>
              </table>
              <button class="remove-btn" onclick="removeMonth('${month}')">Remove Month</button>
            </div>
          `;
          container.appendChild(monthDiv);
        }
      }

      function toggleSalaryMonth(month) {
        const monthData = document.getElementById(`salary-${month}`);
        const toggleIcon =
          monthData.previousElementSibling.querySelector(".toggle-icon");
        if (
          monthData.style.display === "none" ||
          monthData.style.display === ""
        ) {
          monthData.style.display = "block";
          toggleIcon.textContent = "‚ñ≤";
        } else {
          monthData.style.display = "none";
          toggleIcon.textContent = "‚ñº";
        }
      }

      function updateSalary(month, student, newAmount) {
        if (typeof salaryData[month][student] === 'object') {
          salaryData[month][student].amount = Number(newAmount);
        } else {
          salaryData[month][student] = {
            amount: Number(newAmount),
            date: ''
          };
        }
        saveSalaryData();
      }

      function updateSalaryDate(month, student, newDate) {
        if (typeof salaryData[month][student] === 'object') {
          salaryData[month][student].date = newDate;
        } else {
          const amount = salaryData[month][student];
          salaryData[month][student] = {
            amount: amount,
            date: newDate
          };
        }
        saveSalaryData();
      }

      function removeSalary(month, student) {
        delete salaryData[month][student];
        if (Object.keys(salaryData[month]).length === 0) {
          delete salaryData[month];
        }
        saveSalaryData();
        showEmojiAnimation("üóëÔ∏è", event.target);
      }

      function removeMonth(month) {
        delete salaryData[month];
        saveSalaryData();
        showEmojiAnimation("üóëÔ∏è", event.target);
      }

      function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add events
        doc.text("Events of the Day", 10, 10);
        const eventData = events.map((e) => [
          e.name,
          e.type,
          new Date(e.date).toLocaleDateString(),
          e.celebrated ? "Yes" : "No",
        ]);
        doc.autoTable({
          head: [["Name", "Event Type", "Date", "Celebrated"]],
          body: eventData,
          startY: 20,
        });

        // Add salary data
        doc.addPage();
        doc.text("Salary Tracker", 10, 10);
        let salaryTableData = [];
        Object.entries(salaryData).forEach(([month, students]) => {
          Object.entries(students).forEach(([student, data]) => {
            const amount = typeof data === 'object' ? data.amount : data;
            const date = typeof data === 'object' ? data.date : '-';
            salaryTableData.push([
              month,
              student,
              date,
              `Rs. ${amount}`
            ]);
          });
        });
        doc.autoTable({
          head: [["Month", "Student", "Date", "Amount"]],
          body: salaryTableData,
          startY: 20,
        });

        // Add milk consumption data
        doc.addPage();
        doc.text("Milk Consumption", 10, 10);
        let milkTableData = Object.entries(milkData).map(([date, data]) => {
          if (milkBillType === "1~MB") {
            return [date, `${data.quantity} liter(s)`, `Rs. ${data.cost}`];
          } else {
            return [
              date,
              `1st: ${data.quantity1 || 0} liter(s)`,
              `Rs. ${data.cost1 || 0}`,
              `2nd: ${data.quantity2 || 0} liter(s)`,
              `Rs. ${data.cost2 || 0}`,
            ];
          }
        });
        doc.autoTable({
          head:
            milkBillType === "1~MB"
              ? [["Date", "Quantity", "Cost"]]
              : [["Date", "Quantity 1", "Cost 1", "Quantity 2", "Cost 2"]],
          body: milkTableData,
          startY: 20,
        });

        doc.save("personal_data.pdf");
        showEmojiAnimation("üìÑ", document.querySelector(".export-btn"));
      }

      function renderCalendar() {
        const calendar = document.getElementById("milkCalendar");
        calendar.innerHTML = "";
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        document.getElementById(
          "currentMonth"
        ).textContent = `${currentDate.toLocaleString("default", {
          month: "long",
        })} ${year}`;

        for (let i = 0; i < firstDay.getDay(); i++) {
          calendar.appendChild(document.createElement("div"));
        }

        for (let day = 1; day <= lastDay.getDate(); day++) {
          const dayElement = document.createElement("div");
          dayElement.classList.add("calendar-day");
          dayElement.textContent = day;
          const dateString = `${year}-${String(month + 1).padStart(
            2,
            "0"
          )}-${String(day).padStart(2, "0")}`;
          
          // Only add preview events if the date is marked in milkData
          if (milkData[dateString]) {
            dayElement.addEventListener('mousedown', (e) => showDatePreview(e, day));
            dayElement.addEventListener('touchstart', (e) => showDatePreview(e, day));
            dayElement.addEventListener('mouseup', clearDatePreview);
            dayElement.addEventListener('mouseleave', clearDatePreview);
            dayElement.addEventListener('touchend', clearDatePreview);
            dayElement.addEventListener('touchcancel', clearDatePreview);
          }
          
          // Keep the existing click handler for all dates
          dayElement.addEventListener('click', (e) => {
            if (!datePreviewTimer || !milkData[dateString]) {
              showQuantityModal(dateString);
            } else {
              clearTimeout(datePreviewTimer);
              datePreviewTimer = null;
            }
          });

          if (milkData[dateString]) {
            dayElement.classList.add("active");
            if (milkBillType === "1~MB") {
              if (milkData[dateString].quantity > 0) {
                dayElement.innerHTML += `<br>ü•õ ${milkData[dateString].quantity}L`;
              } else {
                dayElement.innerHTML += "<br>‚ùå Nil";
              }
            } else {
              const total =
                (milkData[dateString].quantity1 || 0) +
                (milkData[dateString].quantity2 || 0);
              if (total > 0) {
                dayElement.innerHTML += `<br>ü•õ ${total}L`;
              } else {
                dayElement.innerHTML += "<br>‚ùå Nil";
              }
            }
          }
          calendar.appendChild(dayElement);
        }
      }

      function showQuantityModal(date) {
        selectedDate = date;
        const modal = document.getElementById("quantityModal");
        modal.style.display = "block";
        
        // Store previous quantity if exists
        if (milkData[date]) {
          previousQuantity = JSON.parse(JSON.stringify(milkData[date]));
        }
        
        // Reset form
        document.getElementById("milkQuantity1").value = milkData[date]?.quantity || "";
        if (milkBillType === "2~MB") {
          document.getElementById("milkQuantity2").value = milkData[date]?.quantity2 || "";
        }
        
        // Initialize quick quantity buttons
        updateQuickQuantityButtons(1);
        if (milkBillType === "2~MB") {
          updateQuickQuantityButtons(2);
        }
      }

      function closeQuantityModal() {
        const modal = document.getElementById("quantityModal");
        modal.style.display = "none";
        
        // Restore previous quantity if exists
        if (previousQuantity) {
          milkData[selectedDate] = previousQuantity;
          previousQuantity = null;
          renderCalendar();
        }
      }

      function confirmMilkQuantity() {
        const quantity1 = parseFloat(
          document.getElementById("milkQuantity1").value
        );
        const selectedOption1 =
          document.getElementById("milkQuantity1").options[
            document.getElementById("milkQuantity1").selectedIndex
          ];
        const cost1 = parseFloat(selectedOption1.getAttribute("data-price"));

        if (milkBillType === "1~MB") {
          milkData[selectedDate] = { quantity: quantity1, cost: cost1 };
        } else {
          const quantity2 = parseFloat(
            document.getElementById("milkQuantity2").value
          );
          const selectedOption2 =
            document.getElementById("milkQuantity2").options[
              document.getElementById("milkQuantity2").selectedIndex
            ];
          const cost2 = parseFloat(selectedOption2.getAttribute("data-price"));
          milkData[selectedDate] = { quantity1, cost1, quantity2, cost2 };
        }

        saveMilkData();
        renderCalendar();
        closeQuantityModal();
        const selectedDayElement = document.querySelector(`.calendar-day[data-date="${selectedDate}"]`);
        if (selectedDayElement) {
          showEmojiAnimation('ü•õ', selectedDayElement);
        }
      }

      function changeMonth(delta) {
        currentDate.setMonth(currentDate.getMonth() + delta);
        renderCalendar();
        showEmojiAnimation(delta > 0 ? "‚ñ∂Ô∏è" : "‚óÄÔ∏è", event.target);
      }

      function analyzeMilkConsumption(billNumber) {
        const startDate = new Date(
          document.getElementById(`startDate${billNumber}`).value
        );
        const endDate = new Date(
          document.getElementById(`endDate${billNumber}`).value
        );
        let totalDays = 0;
        let milkTakenDays = 0;
        let totalQuantity = 0;
        let totalCost = 0;

        for (
          let d = new Date(startDate);
          d <= endDate;
          d.setDate(d.getDate() + 1)
        ) {
          totalDays++;
          const dateString = d.toISOString().split("T")[0];
          if (milkData[dateString]) {
            const quantity =
              milkBillType === "1~MB"
                ? milkData[dateString].quantity || 0
                : milkData[dateString][`quantity${billNumber}`] || 0;
            const cost =
              milkBillType === "1~MB"
                ? milkData[dateString].cost || 0
                : milkData[dateString][`cost${billNumber}`] || 0;
            if (quantity > 0) {
              milkTakenDays++;
              totalQuantity += quantity;
              totalCost += cost;
            }
          }
        }

        const resultElement = document.getElementById(
          `analysisResult${billNumber}`
        );
        resultElement.innerHTML = `
                From ${startDate.toLocaleDateString()} to ${endDate.toLocaleDateString()}:<br>
                Milk taken on ${milkTakenDays} out of ${totalDays} days.<br>
                Total quantity: ${totalQuantity.toFixed(1)} liters<br>
                Total cost: ‚Çπ${totalCost.toFixed(2)}
            `;
        showEmojiAnimation("üìä", document.querySelector(".milk-btn"));
      }

      function showEmojiAnimation(emoji, element) {
        const animatedEmoji = document.createElement("span");
        animatedEmoji.textContent = emoji;
        animatedEmoji.classList.add("emoji-animation");
        element.appendChild(animatedEmoji);
        setTimeout(() => {
          animatedEmoji.remove();
        }, 1000);
      }

      function displayMilkQuantities() {
        displayMilkQuantitiesForBill(1, milkQuantities);
        if (milkBillType === "2~MB") {
          displayMilkQuantitiesForBill(2, milkQuantities2);
        }
      }

      function displayMilkQuantitiesForBill(billNumber, quantities) {
        const list = document.getElementById(`milkQuantityList${billNumber}`);
        list.innerHTML = "";
        quantities.forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "milk-quantity-item";
          div.innerHTML = `
            <input type="number" value="${item.quantity}" step="0.1" onchange="updateMilkQuantity(${billNumber}, ${index}, 'quantity', this.value)">
            <input type="number" value="${item.price}" onchange="updateMilkQuantity(${billNumber}, ${index}, 'price', this.value)">
            <button class="remove-btn" onclick="removeMilkQuantity(${billNumber}, ${index})">Remove</button>
          `;
          list.appendChild(div);
        });
      }

      function updateMilkQuantity(billNumber, index, field, value) {
        const quantities = billNumber === 1 ? milkQuantities : milkQuantities2;
        quantities[index][field] = parseFloat(value);
        saveMilkQuantities();
      }

      function removeMilkQuantity(billNumber, index) {
        const quantities = billNumber === 1 ? milkQuantities : milkQuantities2;
        quantities.splice(index, 1);
        saveMilkQuantities();
      }

      function addMilkQuantity(billNumber) {
        const quantity = parseFloat(
          document.getElementById(`newMilkQuantity${billNumber}`).value
        );
        const price = parseFloat(
          document.getElementById(`newMilkPrice${billNumber}`).value
        );
        if (quantity && price) {
          const quantities =
            billNumber === 1 ? milkQuantities : milkQuantities2;
          quantities.push({ quantity, price });
          saveMilkQuantities();
          document.getElementById(`newMilkQuantity${billNumber}`).value = "";
          document.getElementById(`newMilkPrice${billNumber}`).value = "";
        }
      }

      function updateMilkQuantitySelect(billNumber) {
        const select = document.getElementById(`milkQuantity${billNumber}`);
        select.innerHTML = "";
        const quantities = billNumber === 1 ? milkQuantities : milkQuantities2;
        quantities.forEach((item) => {
          const option = document.createElement("option");
          option.value = item.quantity;
          option.textContent = `${item.quantity} liter${
            item.quantity !== 1 ? "s" : ""
          } (‚Çπ${item.price})`;
          option.setAttribute("data-price", item.price);
          select.appendChild(option);
        });
      }

      function changeMilkBillType() {
        milkBillType = document.querySelector(
          'input[name="milkBillType"]:checked'
        ).value;
        localStorage.setItem("milkBillType", milkBillType);
        document
          .getElementById("milkBill2")
          .classList.toggle("hidden", milkBillType === "1~MB");
        document
          .getElementById("milkQuantityList2Container")
          .classList.toggle("hidden", milkBillType === "1~MB");
        document
          .getElementById("milkQuantity2Container")
          .classList.toggle("hidden", milkBillType === "1~MB");
        renderCalendar();
        displayMilkQuantities();
      }

      function downloadData() {
        const data = {
          events: events,
          salaryData: salaryData,
          milkData: milkData,
          milkQuantities: milkQuantities,
          milkQuantities2: milkQuantities2,
          milkBillType: milkBillType,
          userName: userName,
          selectedCategories: selectedCategories,
          quickAmounts: quickAmounts,
        };
        const blob = new Blob([JSON.stringify(data)], {
          type: "application/json",
        });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "personal_tracker_data.json";
        a.click();
        showEmojiAnimation(
          "üíæ",
          document.querySelector(".data-buttons button:first-child")
        );
      }

      function uploadData() {
        const input = document.createElement("input");
        input.type = "file";
        input.accept = ".json";
        input.onchange = function (event) {
          const file = event.target.files[0];
          const reader = new FileReader();
          reader.onload = function (e) {
            const data = JSON.parse(e.target.result);
            events = data.events;
            salaryData = data.salaryData;
            milkData = data.milkData;
            milkQuantities = data.milkQuantities;
            milkQuantities2 = data.milkQuantities2 || milkQuantities2;
            milkBillType = data.milkBillType || "1~MB";
            userName = data.userName || "";
            selectedCategories = data.selectedCategories || [
              "events",
              "salary",
              "milk",
            ];
            document.querySelector(
              `input[name="milkBillType"][value="${milkBillType}"]`
            ).checked = true;
            saveEvents();
            saveSalaryData();
            saveMilkData();
            saveMilkQuantities();
            displayEvents();
            displaySalaryData();
            renderCalendar();
            displayMilkQuantities();
            updateMilkQuantitySelect(1);
            if (milkBillType === "2~MB") {
              updateMilkQuantitySelect(2);
            }
            changeMilkBillType();
            updateUserName();
            updateSelectedCategories();
            showEmojiAnimation(
              "üìÇ",
              document.querySelector(".data-buttons button:last-child")
            );
          };
          reader.readAsText(file);
        };
        input.click();
      }

      // Initialize collapsible functionality
      var coll = document.getElementsByClassName("collapsible");
      for (var i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
          this.classList.toggle("active");
          var content = this.nextElementSibling;
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
          } else {
            content.style.maxHeight = content.scrollHeight + "px";
          }
        });
      }

      function showCustomizationModal() {
        document.getElementById("customizationModal").style.display = "block";
        document.getElementById("eventsCheck").checked =
          selectedCategories.includes("events");
        document.getElementById("salaryCheck").checked =
          selectedCategories.includes("salary");
        document.getElementById("milkCheck").checked =
          selectedCategories.includes("milk");
        document.getElementById("userName").value = userName;
      }

      function applyCustomization() {
        selectedCategories = [];
        if (document.getElementById("eventsCheck").checked)
          selectedCategories.push("events");
        if (document.getElementById("salaryCheck").checked)
          selectedCategories.push("salary");
        if (document.getElementById("milkCheck").checked)
          selectedCategories.push("milk");
        userName = document.getElementById("userName").value;
        localStorage.setItem(
          "selectedCategories",
          JSON.stringify(selectedCategories)
        );
        localStorage.setItem("userName", userName);
        updateSelectedCategories();
        updateUserName();
        document.getElementById("customizationModal").style.display = "none";
      }

      function updateSelectedCategories() {
        document.getElementById("eventsCard").style.display =
          selectedCategories.includes("events") ? "block" : "none";
        document.getElementById("salaryCard").style.display =
          selectedCategories.includes("salary") ? "block" : "none";
        document.getElementById("milkCard").style.display =
          selectedCategories.includes("milk") ? "block" : "none";
      }

      function updateUserName() {
        document.getElementById("userNameDisplay").textContent = userName
          ? ` Yoo It's !! `
          : "";
        document.getElementById("userNameTitle").textContent = userName
          ? `${userName}'s `
          : "";
      }

      // Set initial milk bill type
      document.querySelector(
        `input[name="milkBillType"][value="${milkBillType}"]`
      ).checked = true;
      changeMilkBillType();

      displayEvents();
      displaySalaryData();
      renderCalendar();
      displayMilkQuantities();
      updateMilkQuantitySelect(1);
      if (milkBillType === "2~MB") {
        updateMilkQuantitySelect(2);
      }
      checkForEvents();
      updateSelectedCategories();
      updateUserName();

      // Close modal when clicking outside of it
      window.onclick = function (event) {
        if (event.target == document.getElementById("customizationModal")) {
          document.getElementById("customizationModal").style.display = "none";
        }
        if (event.target == document.getElementById("quantityModal")) {
          closeQuantityModal();
        }
        if (event.target == document.getElementById("quickAmountEdit")) {
          closeQuickAmountEdit();
        }
        if (event.target == document.getElementById("quantityEditModal")) {
          closeQuantityEdit();
        }
      };

      function setQuickAmount(amount) {
        document.getElementById("salaryAmount").value = amount;
        showEmojiAnimation("üí∞", event.target);
      }

      function updateQuickAmountButtons() {
        const quickAmountsContainer = document.querySelector('.quick-amounts');
        quickAmountsContainer.innerHTML = quickAmounts.map((amount, index) => `
          <button class="quick-amount-btn" 
            onclick="setQuickAmount(${amount})"
            onmousedown="startLongPress(${index})"
            onmouseup="clearLongPress()"
            ontouchstart="startLongPress(${index})"
            ontouchend="clearLongPress()"
            ontouchcancel="clearLongPress()"
          >‚Çπ${amount}</button>
        `).join('');
      }

      function startLongPress(index) {
        clearLongPress();
        longPressTimer = setTimeout(() => {
          editingButtonIndex = index;
          const editModal = document.getElementById('quickAmountEdit');
          document.getElementById('newQuickAmount').value = quickAmounts[index];
          editModal.style.display = 'block';
        }, 2000); // 2 seconds
      }

      function clearLongPress() {
        if (longPressTimer) {
          clearTimeout(longPressTimer);
          longPressTimer = null;
        }
      }

      function saveQuickAmount() {
        const newAmount = parseInt(document.getElementById('newQuickAmount').value);
        if (newAmount && editingButtonIndex !== null) {
          quickAmounts[editingButtonIndex] = newAmount;
          localStorage.setItem("quickAmounts", JSON.stringify(quickAmounts));
          updateQuickAmountButtons();
          closeQuickAmountEdit();
          showEmojiAnimation("üí∞", document.querySelector('.quick-amounts'));
        }
      }

      function closeQuickAmountEdit() {
        document.getElementById('quickAmountEdit').style.display = 'none';
        editingButtonIndex = null;
      }

      // Initialize quick amount buttons
      updateQuickAmountButtons();

      function toggleMarkedDates() {
        const summary = document.getElementById("markedDatesSummary");
        const btn = document.querySelector(".show-dates-btn");
        
        if (summary.style.display === "none" || !summary.style.display) {
          const markedDates = [];
          const nilDates = [];
          
          // Get current month and year being displayed
          const currentMonth = currentDate.getMonth();
          const currentYear = currentDate.getFullYear();
          
          for (const [date, data] of Object.entries(milkData)) {
            const dateObj = new Date(date);
            // Only process dates from current month and year
            if (dateObj.getMonth() === currentMonth && dateObj.getFullYear() === currentYear) {
              const dayOfMonth = dateObj.getDate();
              if (data.quantity === 0 || (milkBillType === "2~MB" && data.quantity2 === 0)) {
                nilDates.push(dayOfMonth);
              } else {
                markedDates.push(dayOfMonth);
              }
            }
          }
          
          // Sort dates numerically
          markedDates.sort((a, b) => a - b);
          nilDates.sort((a, b) => a - b);
          
          const monthName = currentDate.toLocaleString('default', { month: 'long' });
          
          summary.innerHTML = `
            <div>
              <strong>${monthName} - Marked Dates (${markedDates.length}):</strong>
              ${markedDates.map(date => `<span class="marked-date">${date}</span>`).join("")}
            </div>
            <div style="margin-top: 8px">
              <strong>${monthName} - Nil Dates (${nilDates.length}):</strong>
              ${nilDates.map(date => `<span class="marked-date">${date}</span>`).join("")}
            </div>
          `;
          
          summary.style.display = "block";
          btn.textContent = "Hide Marked Dates";
          
          // Auto-toggle after 2 seconds
          autoToggleTimeout = setTimeout(() => {
            summary.style.display = "none";
            btn.textContent = "Show Marked Dates";
          }, 2000);
        } else {
          summary.style.display = "none";
          btn.textContent = "Show Marked Dates";
          if (autoToggleTimeout) {
            clearTimeout(autoToggleTimeout);
          }
        }
      }

      function updateQuickQuantityButtons(billNumber) {
        const container = document.getElementById(`quickQuantities${billNumber}`);
        container.innerHTML = quickQuantities.map((quantity, index) => `
          <button class="quick-quantity-btn" 
            onclick="setQuickQuantity(${billNumber}, ${quantity})"
            onmousedown="startQuantityLongPress(${index}, ${billNumber})"
            onmouseup="clearQuantityLongPress()"
            ontouchstart="startQuantityLongPress(${index}, ${billNumber})"
            ontouchend="clearQuantityLongPress()"
            ontouchcancel="clearQuantityLongPress()"
          >${quantity}L</button>
        `).join('');
      }

      function setQuickQuantity(billNumber, quantity) {
        const selectElement = document.getElementById(`milkQuantity${billNumber}`);
        const options = selectElement.options;
        
        // Find and select the matching option
        for (let i = 0; i < options.length; i++) {
          if (parseFloat(options[i].value) === quantity) {
            selectElement.selectedIndex = i;
            break;
          }
        }
        
        showEmojiAnimation("ü•õ", event.target);
      }

      function startQuantityLongPress(index, billNumber) {
        clearQuantityLongPress();
        quantityLongPressTimer = setTimeout(() => {
          editingQuantityIndex = index;
          editingQuantityBillNumber = billNumber;
          const editModal = document.getElementById('quantityEditModal');
          document.getElementById('newQuantityValue').value = quickQuantities[index];
          editModal.style.display = 'block';
        }, 2000);
      }

      function clearQuantityLongPress() {
        if (quantityLongPressTimer) {
          clearTimeout(quantityLongPressTimer);
          quantityLongPressTimer = null;
        }
      }

      function saveQuickQuantity() {
        const newQuantity = parseFloat(document.getElementById('newQuantityValue').value);
        if (newQuantity && editingQuantityIndex !== null) {
          quickQuantities[editingQuantityIndex] = newQuantity;
          localStorage.setItem("quickQuantities", JSON.stringify(quickQuantities));
          updateQuickQuantityButtons(1);
          updateQuickQuantityButtons(2);
          closeQuantityEdit();
          showEmojiAnimation("ü•õ", document.querySelector('.quick-quantities'));
        }
      }

      function closeQuantityEdit() {
        document.getElementById('quantityEditModal').style.display = 'none';
        editingQuantityIndex = null;
        editingQuantityBillNumber = null;
      }

      // Add these functions before the closing script tag
      function showDatePreview(event, day) {
        // Clear any existing preview
        clearDatePreview();
        
        // Don't show preview if it's a quick tap/click
        datePreviewTimer = setTimeout(() => {
          const target = event.currentTarget;
          const rect = target.getBoundingClientRect();
          
          // Create preview element
          datePreviewElement = document.createElement('div');
          datePreviewElement.className = 'date-preview';
          datePreviewElement.textContent = day;
          
          // Position the preview centered above the cell
          datePreviewElement.style.position = 'fixed';
          datePreviewElement.style.left = `${rect.left + (rect.width / 2) - 20}px`;
          datePreviewElement.style.top = `${rect.top - 40}px`;
          
          document.body.appendChild(datePreviewElement);
        }, 1000); // 1 second delay
      }

      function clearDatePreview() {
        if (datePreviewTimer) {
          clearTimeout(datePreviewTimer);
          datePreviewTimer = null;
        }
        
        if (datePreviewElement) {
          datePreviewElement.style.animation = 'fadeOut 0.3s ease-out';
          datePreviewElement.addEventListener('animationend', () => {
            datePreviewElement.remove();
            datePreviewElement = null;
          });
        }
      }
    </script>
  </body>
</html>
